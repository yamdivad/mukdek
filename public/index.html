<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Mukdek</title>
    
    <link rel="icon" type="image/svg+xml" href="favicon.svg" id="dynamic-favicon">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
    <div id="intro-overlay" class="intro-overlay" aria-hidden="true">
        <video id="intro-video" class="intro-video" playsinline preload="auto"></video>
        <button id="intro-skip" class="intro-skip" type="button">SKIP INTRO</button>
        <div id="intro-prompt" class="intro-prompt" aria-hidden="true">TAP TO PLAY</div>
    </div>

    <div id="lobby-overlay">
        <div class="lobby-shell">
            <header class="lobby-brand">
                <div class="lobby-mark">Mukdek</div>
                <div class="lobby-tagline">Digital Edition</div>
            </header>

            <div class="lobby-grid">
                <section class="lobby-card lobby-start">
                    <div class="lobby-card-header">
                        <h2>Start a game</h2>
                        <p>Jump in fast or join a specific room.</p>
                    </div>

                    <div id="lobby-ui-join" class="lobby-join" style="display:block;">
                        <p class="lobby-helper">Ready to play? We will place you in the best open room.</p>
                        <button id="join-btn" onclick="Mukdek.joinGame()">PLAY NOW</button>
                        <p class="lobby-helper-small">Already have a room name? Use Rooms to the right.</p>
                    </div>

                    <div id="lobby-ui-select" class="lobby-identity" style="display:none;">
                        <p class="lobby-helper-strong">You are <strong>Player <span id="lobby-pid">?</span></strong></p>
                        <input type="text" id="name-input" placeholder="INITIALS" maxlength="3">
                        <p class="lobby-helper">Choose your marble color:</p>
                        <div class="color-grid" id="color-container"></div>
                    </div>
                </section>

                <section class="lobby-card lobby-rooms">
                    <div class="lobby-card-header">
                        <h2>Rooms</h2>
                        <p>Join, create, or share a room link.</p>
                    </div>
                    <button id="rooms-toggle" class="rooms-toggle" type="button" aria-expanded="false" aria-controls="rooms-panel">
                        Rooms
                        <span class="rooms-toggle-icon" aria-hidden="true">+</span>
                    </button>
                    <div id="rooms-panel" class="rooms-panel" aria-hidden="true">
                        <div class="room-controls">
                            <label for="room-input" class="room-label">Room</label>
                            <input id="room-input" type="text" placeholder="room-id" maxlength="32" autocapitalize="none" autocomplete="off" spellcheck="false">
                            <button id="room-join-btn" type="button">GO</button>
                            <button id="room-create-btn" type="button">NEW</button>
                            <button id="room-copy-btn" type="button">COPY LINK</button>
                        </div>
                        <div class="room-list">
                            <div class="room-list-header">
                                <span>Active Rooms</span>
                                <button id="room-refresh-btn" type="button">REFRESH</button>
                            </div>
                            <div id="room-refresh-hint">Updated just now</div>
                            <div id="room-list-body">Loading...</div>
                        </div>
                    </div>
                </section>

                <section class="lobby-card lobby-players">
                    <div class="lobby-card-header">
                        <h2>Players</h2>
                        <p>Track readiness and choose the game mode.</p>
                    </div>
                    <div id="ready-tracker">
                        <div id="tk-1" class="tracker-slot" title="Player 1"></div>
                        <div id="tk-2" class="tracker-slot" title="Player 2"></div>
                        <div id="tk-3" class="tracker-slot" title="Player 3"></div>
                        <div id="tk-4" class="tracker-slot" title="Player 4"></div>
                        <div id="tk-5" class="tracker-slot" title="Player 5"></div>
                        <div id="tk-6" class="tracker-slot" title="Player 6"></div>
                        <div class="tracker-upcoming" aria-hidden="true">
                            <span class="tracker-upcoming-banner">COMING SOON</span>
                            <div class="tracker-slot ghost-slot" title="Player 7 (Coming Soon)"></div>
                            <div class="tracker-slot ghost-slot" title="Player 8 (Coming Soon)"></div>
                        </div>
                    </div>

                    <div id="mode-selector">
                        <button id="btn-mode-2p" class="mode-btn visible" style="background:#2e7d32;" onclick="Mukdek.selectMode('2p')">DUEL (2P)</button>
                        <button id="btn-mode-4p" class="mode-btn visible" style="background:#a1887f;" onclick="Mukdek.selectMode('4p')">CLASSIC (4P)</button>
                        <button id="btn-mode-6p" class="mode-btn" style="background:#a1887f;" onclick="Mukdek.selectMode('6p')">CHAOS (6P)</button>
                    </div>
                </section>

                <section class="lobby-card lobby-actions">
                    <div class="lobby-card-header">
                        <h2>Ready check</h2>
                        <p>Confirm when you are ready and start the match.</p>
                    </div>
                    <div id="lobby-msg">Waiting for others...</div>
                    <div class="lobby-action-buttons">
                        <button id="ready-btn" style="display:none;" onclick="Mukdek.clickReady(true)">I'M READY</button>
                        <button id="start-btn" style="display:none;" onclick="Mukdek.requestStart()">START GAME</button>
                        <button id="claim-host-btn" onclick="Mukdek.claimHostManual()">CLAIM HOST üëë</button>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <div id="room-name-modal" class="room-name-modal" aria-hidden="true">
        <div class="room-name-card" role="dialog" aria-modal="true" aria-labelledby="room-name-title">
            <h2 id="room-name-title">Name Your Room</h2>
            <p class="room-name-subtitle">Pick a short, memorable name to share.</p>
            <input id="room-name-input" type="text" maxlength="32" placeholder="room-name" autocapitalize="none" autocomplete="off" spellcheck="false">
            <div class="room-name-actions">
                <button id="room-name-confirm" class="modal-btn btn-yes" type="button">CREATE</button>
                <button id="room-name-cancel" class="modal-btn btn-no" type="button">CANCEL</button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="confirm-modal" aria-hidden="true">
        <div class="confirm-card" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
            <h2 id="confirm-title">Confirm</h2>
            <p id="confirm-message" class="confirm-message"></p>
            <div class="confirm-actions">
                <button id="confirm-yes" class="modal-btn btn-yes" type="button">YES</button>
                <button id="confirm-no" class="modal-btn btn-no" type="button">NO</button>
            </div>
        </div>
    </div>

    <div id="notice-modal" class="confirm-modal" aria-hidden="true">
        <div class="confirm-card" role="dialog" aria-modal="true" aria-labelledby="notice-title">
            <h2 id="notice-title">Notice</h2>
            <p id="notice-message" class="confirm-message"></p>
            <div class="confirm-actions">
                <button id="notice-ok" class="modal-btn btn-yes" type="button">OK</button>
            </div>
        </div>
    </div>

    <div id="game-header">
        <span class="header-spacer" aria-hidden="true"></span>
        <span id="identity-text">MUKDEK</span>
        <div class="header-actions">
            <button id="menu-btn" class="icon-btn menu-btn" type="button" aria-label="Open menu" aria-controls="main-menu" aria-expanded="false">
                <span class="menu-line"></span>
                <span class="menu-line"></span>
                <span class="menu-line"></span>
            </button>
        </div>
        
        <div id="main-menu" role="menu" aria-label="Main menu" aria-hidden="true">
            <button id="menu-stats" type="button">GAME STATS</button>
            <button id="menu-lightning" type="button">ENABLE LIGHTNING</button>
            <button id="menu-notifications" type="button">ENABLE TURN ALERTS</button>
            <button id="menu-restart" type="button">RESTART GAME</button>
        </div>
    </div>

    <div id="target-pop">TARGET!<br>TARGET!<br>TARGET!<span id="target-name">PLAYER X IS LEADING</span></div>
    <div id="lightning-pop">LIGHTNING MODE<br>ACTIVATED!</div>

    <div id="game-area">
        <div id="sidebar">
            <div class="status">
                <div class="player-status" id="p1"><strong>P1</strong><span class="home-count"><span id="h1">0</span>/5</span></div>
                <div class="player-status" id="p2"><strong>P2</strong><span class="home-count"><span id="h2">0</span>/5</span></div>
                <div class="player-status" id="p3"><strong>P3</strong><span class="home-count"><span id="h3">0</span>/5</span></div>
                <div class="player-status" id="p4"><strong>P4</strong><span class="home-count"><span id="h4">0</span>/5</span></div>
                <div class="player-status" id="p5"><strong>P5</strong><span class="home-count"><span id="h5">0</span>/5</span></div>
                <div class="player-status" id="p6"><strong>P6</strong><span class="home-count"><span id="h6">0</span>/5</span></div>
            </div>

            <div id="controls">
                <div id="dice">üé≤</div>
                <button id="roll-btn" class="btn-base" disabled>Wait for Game</button>
            </div>
            <div id="message">Waiting for start...</div>
            <div id="turn-alert-banner" class="turn-alert-banner" role="status" aria-live="polite">
                <div class="turn-alert-text">Enable Turn Alerts in the menu so you hear when it is your turn.</div>
                <button id="turn-alert-dismiss" class="turn-alert-dismiss" type="button" aria-label="Dismiss turn alerts tip">Got it</button>
            </div>
            <div id="emoji-slot-sidebar"></div>

            <div id="stats-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="stats-title">
                <div class="modal-content">
                    <h2 id="stats-title">Game Stats</h2>
                    <div id="stats-body">Waiting for data...</div>
                    <button id="stats-close-btn" class="btn-base" type="button" style="margin-top:20px; background:#5d4037; font-size:1em; padding:10px;">CLOSE</button>
                </div>
            </div>
        </div>

        <div id="board-stack">
            <div id="board-container">
                <div id="board"></div>
                <div id="shortcut-modal">
                    <h2>Shortcut Available!</h2>
                    <p style="color:white; margin-bottom:15px;">Do you want to take the center shortcut?</p>
                    <button class="modal-btn btn-yes" onclick="Mukdek.confirmShortcut(true)">YES!</button>
                    <button class="modal-btn btn-no" onclick="Mukdek.confirmShortcut(false)">NO</button>
                </div>
                <div id="shortcut-target-modal">
                    <h2>Choose a Target</h2>
                    <div id="shortcut-target-options" class="shortcut-target-options"></div>
                    <button id="shortcut-target-cancel" class="modal-btn btn-no">CANCEL</button>
                </div>
            </div>

            <div id="emoji-slot-board">
                <div id="emoji-bar" aria-label="Emoji reactions">
                    <button class="emoji-btn" data-emoji="üòÄ" aria-label="Grinning face">üòÄ</button>
                    <button class="emoji-btn" data-emoji="ü§£" aria-label="Rolling on the floor laughing">ü§£</button>
                    <button class="emoji-btn" data-emoji="üòé" aria-label="Smiling face with sunglasses">üòé</button>
                    <button class="emoji-btn" data-emoji="üò°" aria-label="Angry face">üò°</button>
                    <button class="emoji-btn" data-emoji="üò±" aria-label="Screaming face">üò±</button>
                    <button class="emoji-btn" data-emoji="üò≥" aria-label="Wide eyes face">üò≥</button>
                    <button class="emoji-btn" data-emoji="üí©" aria-label="Pile of poo">üí©</button>
                    <button class="emoji-btn" data-emoji="ü´†" aria-label="Melting face">ü´†</button>
                    <button class="emoji-btn" data-emoji="‚ò†Ô∏è" aria-label="Skull and crossbones">‚ò†Ô∏è</button>
                    <button class="emoji-btn" data-emoji="üéª" aria-label="Violin">üéª</button>
                </div>
            </div>
        </div>
    </div>

    <div id="emoji-stream" aria-hidden="true"></div>

    <audio id="turn-audio" src="assets/player-turn.mp3" preload="auto"></audio>
    <audio id="constipation-audio" src="assets/Constipation.mp3" preload="auto"></audio>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js/gameLogic.js"></script>
    <script src="client/state.js"></script>
    <script src="client/ui.js"></script>
    <script src="client/board.js"></script>
    <script src="client/socket.js"></script>
    <script src="client/main.js"></script>
</body>
</html>
